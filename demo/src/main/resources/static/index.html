<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Tracker Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 20px;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    th {
      background: #007bff;
      color: #fff;
    }

    tr:hover {
      background: #f1f1f1;
    }

    button {
      margin: 5px;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .btn-add {
      background-color: #28a745;
      color: white;
    }

    .btn-edit {
      background-color: #ffc107;
      color: black;
    }

    .btn-delete {
      background-color: #dc3545;
      color: white;
    }

    .limit-box {
      margin-top: 20px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
    }

    .summary {
      margin-top: 20px;
      padding: 15px;
      background: #e9ecef;
      border-left: 5px solid #007bff;
      border-radius: 6px;
      font-weight: bold;
      text-align: center;
    }

    input, select {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <h1>Expense Tracker Dashboard</h1>
  <div class="container">

    
    <form id="expenseForm">
  <input type="text" id="title" placeholder="Title" required />
  
  <select id="category" required>
    <option value="">Select Category</option>
    <option value="Food">Food</option>
    <option value="Transport">Transport</option>
    <option value="Bills">Bills</option>
    <option value="Entertainment">Entertainment</option>
    <option value="Health">Health</option>
    <option value="Other">Other</option>
  </select>

  <input type="number" id="amount" placeholder="Amount" required />
  <input type="date" id="date" required />
  <button type="submit" class="btn-add">Add Expense</button>
</form>


    
    <div class="limit-box">
      <h3>Set Spending Limit</h3>
      <input type="number" id="limitInput" placeholder="Enter limit" />
      <button onclick="setLimit()" class="btn-add">Save Limit</button>
      <p id="limitMsg"></p>
    </div>

    
    <h3>Expenses</h3>
    <table id="expense-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Category</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    
    <div id="summary" class="summary">
      Majority of expenses will be shown here...
    </div>
  </div>

  <script>
    let expenses = [];
    let limit = 0;

    
    window.onload = loadExpenses;

    function loadExpenses() {
      fetch("/api/expenses")
        .then(res => res.json())
        .then(data => {
          expenses = data;
          renderTable();
          updateSummary();
        });
    }

    
    function renderTable() {
      const tbody = document.querySelector("#expense-table tbody");
      tbody.innerHTML = "";
      expenses.forEach(exp => {
        const row = `
          <tr>
            <td>${exp.id}</td>
            <td>${exp.title}</td>
            <td>${exp.category}</td>
            <td>${exp.amount}</td>
            <td>${new Date(exp.date).toLocaleDateString()}</td>
            <td>
              <button class="btn-edit" onclick="editExpense(${exp.id})">Edit</button>
              <button class="btn-delete" onclick="deleteExpense(${exp.id})">Delete</button>
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    
    document.getElementById("expenseForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const newExp = {
        title: document.getElementById("title").value,
        category: document.getElementById("category").value,
        amount: document.getElementById("amount").value,
        date: document.getElementById("date").value
      };
      fetch("/api/expenses", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newExp)
      })
        .then(res => res.json())
        .then(data => {
          expenses.push(data);
          renderTable();
          updateSummary();
          this.reset();
        });
    });

    
    function editExpense(id) {
      const exp = expenses.find(e => e.id === id);
      document.getElementById("title").value = exp.title;
      document.getElementById("category").value = exp.category;
      document.getElementById("amount").value = exp.amount;
      document.getElementById("date").value = exp.date.split("T")[0];
      deleteExpense(id, false);
    }

    
    function deleteExpense(id, refresh = true) {
      fetch(`/api/expenses/${id}`, { method: "DELETE" })
        .then(() => {
          expenses = expenses.filter(e => e.id !== id);
          if (refresh) {
            renderTable();
            updateSummary();
          }
        });
    }

    
    function setLimit() {
      limit = parseInt(document.getElementById("limitInput").value);
      document.getElementById("limitMsg").innerText = `Limit set to ${limit}`;
      checkLimit();
    }

    
    function checkLimit() {
      const total = expenses.reduce((sum, e) => sum + parseFloat(e.amount), 0);
      if (limit > 0 && total > limit) {
        alert("Warning: You exceeded your spending limit!");
      }
    }

    
    function updateSummary() {
      if (expenses.length === 0) {
        document.getElementById("summary").innerText = "No expenses yet.";
        return;
      }
      const categoryCount = {};
      expenses.forEach(e => {
        categoryCount[e.category] = (categoryCount[e.category] || 0) + e.amount;
      });
      const topCategory = Object.keys(categoryCount).reduce((a, b) =>
        categoryCount[a] > categoryCount[b] ? a : b
      );
      document.getElementById("summary").innerText =
        `Majority of expenses are in "${topCategory}" (${categoryCount[topCategory]} rupees)`;
      checkLimit();
    }
  </script>
</body>
</html>
